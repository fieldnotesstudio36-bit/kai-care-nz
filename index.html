<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Find free and low-cost community services in New Zealand - food banks, op shops, health services, and more">
    <meta name="theme-color" content="#1a2332">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=180&q=80">
    <title>Kai & Care NZ - Find Help Near You</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: #1a2332; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; padding: 40px 20px; }
        .header { text-align: center; margin-bottom: 50px; }
        .header h1 { font-size: 3rem; color: white; margin-bottom: 15px; font-weight: 700; }
        .header p { font-size: 1.4rem; color: rgba(255,255,255,0.9); }
        .city-selector { max-width: 600px; margin: 0 auto 50px; }
        .city-selector select { width: 100%; padding: 20px; font-size: 1.3rem; border: 3px solid #ddd; border-radius: 12px; background: white; cursor: pointer; font-weight: 600; }
        .category-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 30px; margin-bottom: 50px; }
        .category-card { position: relative; height: 300px; border-radius: 20px; overflow: hidden; cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease; box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
        .category-card:hover { transform: translateY(-8px); box-shadow: 0 12px 30px rgba(0,0,0,0.25); }
        .category-card img { width: 100%; height: 100%; object-fit: cover; }
        .category-overlay { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0.3)); padding: 30px; color: white; }
        .category-card .emoji { font-size: 3rem; margin-bottom: 10px; display: block; }
        .category-card h2 { font-size: 2rem; font-weight: 700; margin-bottom: 5px; letter-spacing: 0.05em; }
        .category-card p { font-size: 1.1rem; opacity: 0.9; }
        .back-button { display: inline-flex; align-items: center; gap: 10px; padding: 15px 30px; font-size: 1.2rem; font-weight: 600; background: #667eea; color: white; border: none; border-radius: 12px; cursor: pointer; margin-bottom: 30px; }
        .services-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; }
        .service-card { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.3s ease; }
        .service-card:hover { transform: translateY(-6px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
        .service-card img { width: 100%; height: 200px; object-fit: cover; }
        .service-card-content { padding: 20px; }
        .service-card h3 { font-size: 1.5rem; margin-bottom: 10px; color: #333; }
        .service-card p { color: #666; font-size: 1.05rem; line-height: 1.5; }
        .calendar-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .day-column { background: white; border-radius: 16px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .day-column h3 { font-size: 1.6rem; color: #667eea; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 3px solid #667eea; }
        .meal-entry { background: #f9f9f9; padding: 18px; border-radius: 12px; margin-bottom: 15px; border-left: 5px solid #ff9800; }
        .meal-name { font-size: 1.2rem; font-weight: 700; color: #333; margin-bottom: 8px; }
        .meal-info { font-size: 1.05rem; color: #666; }
        .suggest-button { position: fixed; bottom: 30px; right: 30px; padding: 20px 35px; font-size: 1.3rem; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); z-index: 100; }
        .donate-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 50px 40px; text-align: center; color: white; margin-top: 60px; }
        .donate-btn { background: white; color: #667eea; padding: 15px 30px; border-radius: 12px; border: none; font-weight: 700; margin: 10px; cursor: pointer; }
        @media (max-width: 768px) { .category-grid { grid-template-columns: 1fr; } .header h1 { font-size: 2rem; } }
    </style>
</head>
<body>
    <div id="app"></div>
    <button class="suggest-button" onclick="window.open('https://docs.google.com/forms/d/11c4SKLiwgM-sv1RHxj8JBGMa-PkcLpujpYEM69sbgm8', '_blank')">‚ûï Suggest Service</button>

    <script>
        const SHEET_ID = '11c4SKLiwgM-sv1RHxj8JBGMa-PkcLpujpYEM69sbgm8';
        const SHEET_NAME = 'Services';
        let SERVICES = [];

        const CATEGORIES = [
            { id: 'Community', emoji: 'üìö', name: 'COMMUNITY', subtitle: 'Libraries & warm spaces', image: 'https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=800&q=80' },
            { id: 'Food', emoji: 'üç≤', name: 'FOOD', subtitle: 'Meals & food banks', image: 'https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=800&q=80' },
            { id: 'Whanau', emoji: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', name: 'WHƒÄNAU', subtitle: 'Families & children', image: 'https://images.unsplash.com/photo-1511895426328-dc8714191300?w=800&q=80' },
            { id: 'Activities', emoji: 'üéâ', name: 'ACTIVITIES', subtitle: 'Free fun & events', image: 'https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=800&q=80' },
            { id: 'Clothing', emoji: 'üëï', name: 'OP SHOPS', subtitle: 'Affordable clothing', image: 'https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=800&q=80' },
            { id: 'Health', emoji: 'üè•', name: 'HAUORA', subtitle: 'Health & hygiene facilities', image: 'https://images.unsplash.com/photo-1631217868264-e5b90bb7e133?w=800&q=80' },
            { id: 'Legal', emoji: '‚öñÔ∏è', name: 'LEGAL SUPPORT', subtitle: 'Immigration & community law', image: 'https://images.unsplash.com/photo-1589829545856-d10d557cf95f?w=800&q=80' },
            { id: 'Transport', emoji: 'üöå', name: 'TRANSPORT', subtitle: 'Travel support', image: 'https://images.unsplash.com/photo-1570125909232-eb263c188f7e?w=800&q=80' },
            { id: 'Employment', emoji: 'üíº', name: 'WORK', subtitle: 'Job support', image: 'https://images.unsplash.com/photo-1521737711867-e3b97375f902?w=800&q=80' }
        ];

        const FOOD_CALENDAR = {
            Monday: [{ name: "Nelson City Mission Lunch", time: "12:00pm - 1:30pm", location: "46 Waimea Road" }],
            Tuesday: [{ name: "St John's Community Kai", time: "6:00pm - 7:00pm", location: "3 Vanguard Street" }],
            Wednesday: [{ name: "Nelson City Mission Lunch", time: "12:00pm - 1:30pm", location: "46 Waimea Road" }],
            Thursday: [{ name: "Elim Church Meal", time: "5:00pm - 6:30pm", location: "26 Halifax Street" }],
            Friday: [{ name: "Salvation Army Dinner", time: "5:00pm - 6:30pm", location: "18 Selwyn Place" }],
            Saturday: [{ name: "Cathedral Breakfast", time: "9:00am - 10:30am", location: "Trafalgar Square" }],
            Sunday: [{ name: "Victory Centre Roast", time: "12:30pm - 2:00pm", location: "Rutherford Park" }]
        };

        let currentPage = 'home';
        let selectedCity = 'All Cities';
        let selectedCategory = null;

        async function loadServicesFromSheet() {
            try {
                const url = `https://docs.google.com/spreadsheets/d/e/2PACX-1vShhl35046lXVNAsV2xTxYeSlxOK7w2gGI9jSxS6-7ZkjwuizZrcuRKgrjmW70D6wmEhFCRPEmyquj4/pub?output=csv`;
                const response = await fetch(url);
                const csvText = await response.text();
                const lines = csvText.split('\n').slice(1);
                SERVICES = lines.map(line => {
                    const f = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    return { name: f[1]?.replace(/"/g,''), category: f[2]?.replace(/"/g,''), city: f[3]?.replace(/"/g,''), notes: f[7]?.replace(/"/g,''), image: f[8]?.replace(/"/g,'') || 'https://images.unsplash.com/photo-1497366216548-37526070297c?w=800&q=80' };
                }).filter(s => s.name);
                render();
            } catch (e) { console.error("Data load failed", e); render(); }
        }

        function render() {
            const app = document.getElementById('app');
            if (currentPage === 'home') app.innerHTML = renderHome();
            else if (currentPage === 'category') app.innerHTML = renderCategoryPage();
        }

        function renderHome() {
            return `
                <div class="container">
                    <div class="header"><h1>Kai & Care NZ</h1><p>Kia ora! Find help near you</p></div>
                    <div class="category-grid">
                        ${CATEGORIES.map(cat => `
                            <div class="category-card" onclick="openCategory('${cat.id}')">
                                <img src="${cat.image}"><div class="category-overlay"><span class="emoji">${cat.emoji}</span><h2>${cat.name}</h2><p>${cat.subtitle}</p></div>
                            </div>`).join('')}
                    </div>
                    <div style="border-radius: 20px; overflow: hidden; margin-top: 50px;">
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d188046.22384666576!2d173.11186255!3d-41.289139!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x6d3becc24375b47b%3A0x500ef6143a29910!2sNelson!5e0!3m2!1sen!2snz!4v1700000000000" width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
                    </div>
                    <div class="donate-card"><h2>üíù Support Kai & Care NZ</h2><p>Help us keep this service free.</p><button class="donate-btn">$2</button><button class="donate-btn">$10</button></div>
                </div>`;
        }

        function renderCategoryPage() {
            const cat = CATEGORIES.find(c => c.id === selectedCategory);
            const filtered = SERVICES.filter(s => s.category === selectedCategory);
            
            let content = `<button class="back-button" onclick="goHome()">‚Üê Back</button><div class="header"><h1>${cat.emoji} ${cat.name}</h1></div>`;
            
            if (selectedCategory === 'Food') {
                content += `<div class="calendar-grid">${Object.keys(FOOD_CALENDAR).map(day => `
                    <div class="day-column"><h3>${day}</h3>${FOOD_CALENDAR[day].map(m => `
                        <div class="meal-entry"><div class="meal-name">${m.name}</div><div class="meal-info">üïí ${m.time}<br>üìç ${m.location}</div></div>`).join('')}
                    </div>`).join('')}</div><h2 style="color:white; margin: 40px 0 20px; text-align:center;">Food Banks & Pantries</h2>`;
            }

            content += `<div class="services-list">${filtered.map(s => `
                <div class="service-card"><img src="${s.image}"><div class="service-card-content"><h3>${s.name}</h3><p>üìç ${s.city}</p><p>${s.notes || ''}</p></div></div>`).join('')}</div>`;
            return `<div class="container">${content}</div>`;
        }

        function openCategory(id) { selectedCategory = id; currentPage = 'category'; render(); }
        function goHome() { currentPage = 'home'; render(); }

        window.onload = loadServicesFromSheet;
    </script>
</body>
</html>
